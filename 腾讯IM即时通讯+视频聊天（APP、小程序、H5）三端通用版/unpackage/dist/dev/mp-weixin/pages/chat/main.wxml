<view class="chat _div" style="{{'padding-bottom:'+(isIphoneX?safeBottom+70+'px':'70px')+';'}}" id="chat" data-event-opts="{{[['longpress',[['handleLongPress',['$event']]]],['touchmove',[['handleTouchMove',['$event']]]],['touchend',[['handleTouchEnd',['$event']]]]]}}" bindlongpress="__e" bindtouchmove="__e" bindtouchend="__e"><view class="{{['record-modal _div',isRecording?'':'modal-display']}}"><view class="wrapper _div"><view class="modal-loading _div"></view></view><view class="modal-title _div">{{''+title+''}}</view></view><view id="list" data-event-opts="{{[['tap',[['loseFocus',['$event']]]]]}}" bindtap="__e" class="_div"><block wx:for="{{currentMessageList}}" wx:for-item="message" wx:for-index="index" wx:key="index"><view id="{{message.ID}}" class="_div"><block wx:if="{{message.type==='TIMGroupTipElem'||message.type==='TIMGroupSystemNoticeElem'}}"><view class="notice _div"><view class="content _div"><block wx:for="{{message.virtualDom}}" wx:for-item="div" wx:for-index="index1" wx:key="index1"><label class="_span"><block wx:if="{{div.name==='groupTip'||'system'}}"><label class="_span">{{div.text}}</label></block></label></block></view></view></block><block wx:else><block wx:if="{{message.isRevoked}}"><view class="_div"><view class="notice _div"><view class="content _div"><block wx:if="{{message.from===myInfo.userID}}">你撤回了一条消息</block><block wx:else>{{message.from+"撤回了一条消息"}}</block></view><block wx:if="{{message.from===myInfo.userID}}"><block wx:if="{{currentTime-message.time<120&&message.type==='TIMTextElem'}}"><view data-event-opts="{{[['tap',[['reEdit',['$0'],[[['currentMessageList','',index]]]]]]]}}" class="re-edit _div" bindtap="__e">重新编辑</view></block></block></view></view></block><block wx:else><view class="{{['_div',message.flow==='out'?'item-right':'item-left']}}"><view class="content _div"><view class="name _div"><block wx:if="{{currentConversation.type==='C2C'}}"><block wx:if="{{message.flow==='in'}}">{{''+(currentConversation.userProfile.nick||currentConversation.userProfile.userID)+''}}</block><block wx:else>{{''+(myInfo.nick||myInfo.userID)+''}}</block></block><block wx:else>{{''+(message.nameCard||message.nick||myInfo.nick||message.from)+''}}</block></view><view data-event-opts="{{[['longpress',[['handleMessage',['$0'],[[['currentMessageList','',index]]]]]]]}}" class="wrapper _div" bindlongpress="__e"><block wx:if="{{currentConversation.type==='C2C'&&message.from===myInfo.userID&&message.status==='success'}}"><view class="name read-receipts _div"><block wx:if="{{message.isPeerRead}}">已读</block><block wx:else>未读</block></view></block><block wx:if="{{message.from===myInfo.userID}}"><view data-event-opts="{{[['tap',[['handleResend',['$0'],[[['currentMessageList','',index]]]]]]]}}" class="load _div" bindtap="__e"><view class="{{['_div',message.status]}}"></view></view></block><block wx:if="{{message.type==='TIMTextElem'}}"><view class="message _div"><view class="text-message _div"><block wx:for="{{message.virtualDom}}" wx:for-item="div" wx:for-index="index2" wx:key="index2"><label class="_span"><block wx:if="{{div.name==='span'}}"><label class="_span">{{div.text}}</label></block><block wx:if="{{div.name==='img'}}"><image style="width:20px;height:20px;" src="{{div.src}}"></image></block></label></block></view></view></block><block wx:else><block wx:if="{{message.type==='TIMImageElem'}}"><image class="image-message" src="{{message.payload.imageInfoArray[1].url}}" mode="widthFix" data-event-opts="{{[['tap',[['previewImage',['$0'],[[['currentMessageList','',index,'payload.imageInfoArray.__$n1.url']]]]]]]}}" bindtap="__e"></image></block><block wx:else><block wx:if="{{message.type==='TIMFileElem'}}"><view class="message _div"><view data-event-opts="{{[['tap',[['handleDownload',['$0'],[[['currentMessageList','',index,'payload']]]]]]]}}" class="file _div" bindtap="__e"><image style="width:100rpx;height:100rpx;border-radius:50%;" src="../../static/images/file.png"></image><view class="_div">{{message.payload.fileName}}</view></view></view></block><block wx:else><block wx:if="{{message.type==='TIMCustomElem'}}"><view class="message _div"><block wx:if="{{message.payload.data==='survey'}}"><view class="survey _div"><view class="title _div">对IM DEMO的评分和建议</view><view class="description _div"></view><view class="suggestion _div"><view class="_div">{{message.payload.extension}}</view></view></view></block><block wx:else><block wx:if="{{message.payload.data==='group_create'}}"><view class="_div"><view class="_div">{{message.payload.extension}}</view></view></block><block wx:else><block wx:if="{{message.virtualDom[0].name==='videoCall'}}"><view class="custom-elem _div"><view class="_div">{{message.virtualDom[0].text}}</view></view></block><block wx:else><view class="custom-elem _div">自定义消息</view></block></block></block></view></block><block wx:else><block wx:if="{{message.type==='TIMSoundElem'}}"><view class="message _div" url="{{message.payload.url}}"><view data-event-opts="{{[['tap',[['openAudio',['$0'],[[['currentMessageList','',index,'payload']]]]]]]}}" class="box _div" bindtap="__e"><image style="height:22px;width:22px;" src="../../static/images/audio-play.png"></image><view style="padding-left:4px;" class="_div">{{message.payload.second+"s"}}</view></view></view></block><block wx:else><block wx:if="{{message.type==='TIMFaceElem'}}"><view class="message _div"><view class="custom-elem _div"><image style="height:90px;width:90px;" src="{{faceUrl+message.payload.data+'.png'}}"></image></view></view></block><block wx:else><block wx:if="{{message.type==='TIMVideoFileElem'}}"><view class="message _div"><video class="video" src="{{message.payload.videoUrl}}" poster="{{message.payload.thumbUrl}}" object-fit="contain" data-event-opts="{{[['error',[['videoError',['$event']]]]]}}" binderror="__e"></video></view></block></block></block></block></block></block></block></view></view><view class="_div"><block wx:if="{{message.flow==='out'}}"><image style="width:100rpx;height:100rpx;border-radius:50%;" src="{{myInfo.avatar}}" mode></image></block><block wx:else><block wx:if="{{currentConversation.type==='C2C'}}"><image style="width:100rpx;height:100rpx;border-radius:50%;" src="{{currentConversation.userProfile.avatar}}" data-event-opts="{{[['tap',[['toDetail',['$event']]]]]}}" bindtap="__e"></image></block><block wx:else><image style="width:100rpx;height:100rpx;border-radius:50%;" src="{{message.avatar}}" data-event-opts="{{[['tap',[['toDetail',[['o',['userID',message.from]]]]]]]}}" bindtap="__e"></image></block></block></view></view></block></block></view></block></view><view class="bottom _div" style="{{'padding-bottom:'+(isIphoneX?safeBottom+'px':'')+';'}}"><view class="bottom-div _div"><block wx:if="{{!isRecord}}"><view style="width:100%;" class="_div"><input class="input" type="text" confirm-type="send" cursor-spacing="10" focus="{{isFocus}}" data-event-opts="{{[['focus',[['e0',['$event']]]],['blur',[['e1',['$event']]]],['confirm',[['sendMessage',['$event']]]],['input',[['__set_model',['','messageContent','$event',[]]]]]]}}" value="{{messageContent}}" bindfocus="__e" bindblur="__e" bindconfirm="__e" bindinput="__e"/></view></block><block wx:if="{{isRecord}}"><view class="record _div" id="record"><block wx:if="{{!isRecording}}">按住 说话</block><block wx:if="{{isRecording}}">抬起 停止</block></view></block><view data-event-opts="{{[['tap',[['handleEmoji']]]]}}" class="btn _div" bindtap="__e"><image style="width:50rpx;height:50rpx;" src="/static/images/smile.png" mode></image></view><block wx:if="{{messageContent.length!==0}}"><view data-event-opts="{{[['tap',[['sendMessage',['$event']]]]]}}" class="send _div" bindtap="__e">发送</view></block><block wx:else><view data-event-opts="{{[['tap',[['handleMore']]]]}}" class="btn _div" bindtap="__e"><image style="width:50rpx;height:50rpx;" src="/static/images/more.png" mode></image></view></block></view><block wx:if="{{isEmojiOpen}}"><view class="bottom-emoji _div"><view class="emoji-tab _div"><view class="tabs _div"><view data-event-opts="{{[['tap',[['handleEmojiShow',['$event']]]]]}}" class="{{['single _div',emojiShow?'choosed':'']}}" bindtap="__e"><image style="width:100%;height:100%;" src="../../static/images/smile.png"></image></view></view></view><block wx:if="{{emojiShow}}"><view class="emojis _div"><block wx:for="{{emojiName}}" wx:for-item="emojiItem" wx:for-index="index3" wx:key="index3"><view data-event-opts="{{[['tap',[['chooseEmoji',['$0'],[[['emojiName','',index3]]]]]]]}}" class="emoji _div" bindtap="__e"><image style="width:100%;height:100%;" src="{{emojiUrl+emojiMap[emojiItem]}}"></image></view></block></view></block></view></block><block wx:if="{{isMoreOpen}}"><view class="bottom-image _div"><view class="images _div"><view data-event-opts="{{[['tap',[['sendPhoto',['camera']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/take-pic.png"></image></view><view class="name _div">拍摄</view></view><view data-event-opts="{{[['tap',[['sendPhoto',['album']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/picture.png"></image></view><view class="name _div">图片</view></view><view data-event-opts="{{[['tap',[['customModal']]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/custom.png"></image></view><view class="name _div">自定义消息</view></view><view data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/rating.png"></image></view><view class="name _div">评分</view></view></view><view class="images _div"><view data-event-opts="{{[['tap',[['video',['$event']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/video-file.png"></image></view><view class="name _div">视频</view></view><block wx:if="{{currentConversation.type==='C2C'}}"><view data-event-opts="{{[['tap',[['videoCall',['$event']]]]]}}" class="block _div" bindtap="__e"><view class="image _div"><image class="icon" src="../../static/images/video.png"></image></view><view class="name _div">视频通话</view></view></block></view></view></block></view><view class="float-button-list _div"><block wx:if="{{currentConversation.type==='C2C'}}"><image class="video-icon" src="../../static/images/camera.png" data-event-opts="{{[['tap',[['videoCall',['$event']]]]]}}" bindtap="__e"></image></block><image src="../../static/images/conversation-profile.png" data-event-opts="{{[['tap',[['toDetail',['$event']]]]]}}" bindtap="__e"></image></view></view>